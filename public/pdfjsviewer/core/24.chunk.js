/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[24],{384:function(Ca,ua,x){x.r(ua);var pa=x(2),la=x(16),ka=x(1);Ca=x(48);var ha=x(32),da=x(9);x=function(){function z(){this.init()}z.prototype.init=function(){this.dY=!1;this.xe=this.lj=this.connection=null;this.Wo={};this.za=this.BA=null};z.prototype.Daa=function(r){for(var w=this,h=0;h<r.length;++h){var a=r[h];switch(a.at){case "create":this.Wo[a.author]||(this.Wo[a.author]=a.aName);this.F3(a);break;case "modify":this.za.Pp(a.xfdf).then(function(b){w.za.JP(b[0])});
break;case "delete":this.za.Pp("<delete><id>"+a.aId+"</id></delete>")}}};z.prototype.F3=function(r){var w=this;this.za.Pp(r.xfdf).then(function(h){h=h[0];h.authorId=r.author;w.za.JP(h);w.za.trigger(la.a.UPDATE_ANNOTATION_PERMISSION,[h])})};z.prototype.e3=function(r,w,h){this.lj&&this.lj(r,w,h)};z.prototype.preloadAnnotations=function(r){this.addEventListener("webViewerServerAnnotationsEnabled",this.e3.bind(this,r,"add",{imported:!1}),{once:!0})};z.prototype.initiateCollaboration=function(r,w,h){var a=
this;if(r){a.xe=w;a.za=h.Da();h.addEventListener(la.c.DOCUMENT_UNLOADED,function(){a.disableCollaboration()});a.Zaa(r);var b=new XMLHttpRequest;b.addEventListener("load",function(){if(200===b.status&&0<b.responseText.length)try{var e=JSON.parse(b.responseText);a.connection=exports.Na.Fba(Object(ha.h)(a.xe,"blackbox/"),"annot");a.BA=e.id;a.Wo[e.id]=e.user_name;a.za.GQ(e.id);a.connection.NG(function(n){n.t&&n.t.startsWith("a_")&&n.data&&a.Daa(n.data)},function(){a.connection.send({t:"a_retrieve",dId:r});
a.trigger(z.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[a.Wo[e.id],a.BA])},function(){a.disableCollaboration()})}catch(n){Object(ka.g)(n.message)}});b.open("GET",Object(ha.h)(this.xe,"demo/SessionInfo.jsp"));b.withCredentials=!0;b.send();a.dY=!0;a.za.q9(function(e){return a.Wo[e.Author]||e.Author})}else Object(ka.g)("Document ID required for collaboration")};z.prototype.disableCollaboration=function(){this.lj&&(this.za.removeEventListener(da.a.Events.ANNOTATION_CHANGED,this.lj),this.lj=null);this.connection&&
this.connection.$C();this.za&&this.za.GQ("Guest");this.init();this.trigger(z.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};z.prototype.Zaa=function(r){var w=this;this.lj&&this.za.removeEventListener(da.a.Events.ANNOTATION_CHANGED,this.lj);this.lj=function(h,a,b){return Object(pa.b)(this,void 0,void 0,function(){var e,n,f,y,ba,aa,ia,ca,ea;return Object(pa.d)(this,function(fa){switch(fa.label){case 0:if(b.imported)return[2];e={t:"a_"+a,dId:r,annots:[]};return[4,w.za.a0()];case 1:n=fa.fa();"delete"!==
a&&(f=(new DOMParser).parseFromString(n,"text/xml"),y=new XMLSerializer);for(ba=0;ba<h.length;ba++)aa=h[ba],ca=ia=void 0,"add"===a?(ia=f.querySelector('[name="'+aa.Id+'"]'),ca=y.serializeToString(ia),ea=null,aa.InReplyTo&&(ea=w.za.qD(aa.InReplyTo).authorId||"default"),e.annots.push({at:"create",aId:aa.Id,author:w.BA,aName:w.Wo[w.BA],parent:ea,xfdf:"<add>"+ca+"</add>"})):"modify"===a?(ia=f.querySelector('[name="'+aa.Id+'"]'),ca=y.serializeToString(ia),e.annots.push({at:"modify",aId:aa.Id,xfdf:"<modify>"+
ca+"</modify>"})):"delete"===a&&e.annots.push({at:"delete",aId:aa.Id});0<e.annots.length&&w.connection.send(e);return[2]}})})}.bind(w);this.za.addEventListener(da.a.Events.ANNOTATION_CHANGED,this.lj)};z.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return z}();Object(Ca.a)(x);ua["default"]=x}}]);}).call(this || window)
